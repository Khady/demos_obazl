load(
    "@rules_ocaml//build:rules.bzl",
    "ocaml_module",
    "ocaml_library",
    "ocaml_ns_resolver",
    "ocaml_test",
)

ocaml_ns_resolver(
    name = "greek_ns",
    ns   = "Greek",
    names = [
        "Alpha",
        "Beta",
        "Gamma",
        ],
    submodules = {
        # include and alias exogenous namespaced submodules
        # e.g. colors:Red will be accessible as Greek.Red
        "//ns/bottomup/mwe/exogenous_submodules/colors:Red"  : "Red",
        "//ns/bottomup/mwe/exogenous_submodules/colors:Green": "Green",
        "//ns/bottomup/mwe/exogenous_submodules/colors:Blue" : "Blue",
    },
)

# package resolver and submodules in one library
ocaml_library(
    name = "Greek",
    manifest = [
        # ":greek_ns",
        ":Alpha",
        ":Beta",
        ":Gamma",
        "//ns/bottomup/mwe/exogenous_submodules/colors:libColor"
    ],
)

ocaml_module(
    name        = "Alpha",
    ns_resolver = ":greek_ns",
    struct      = "alpha.ml",
)

ocaml_module(
    name        = "Beta",
    ns_resolver = ":greek_ns",
    struct      = "beta.ml",
)

ocaml_module(
    name        = "Gamma",
    ns_resolver = ":greek_ns",
    struct      = "gamma.ml",
)

ocaml_test(
    name = "test",
    main = "Test"
)

ocaml_module(
    name   = "Test",
    struct = "test.ml",
    deps = [
        ":Greek",
        "@ounit2//:ounit2",
    ],
)
